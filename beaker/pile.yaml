version: v2
description: Dawg on the Pile split {{.Env.SPLIT}}
tasks:
  - name: build-dawg
    image:
      beaker: willm/rusty-dawg-stype
    command: [scripts/run_pile_beaker.sh]
    envVars:
      - name: SPLIT
        value: {{.Env.SPLIT}}
      - name: SPLIT_TYPE
        # Either original (30 splits) or splits (150 splits)
        value: original
      - name: GCLOUD_KEY
        value: /gcloud_key.json
    datasets:
      - mountPath: /gcloud_key.json
        source:
          secret: WILLM_GCLOUD_KEY
    result:
      path: /output
    context:
      priority: normal
    constraints:
      # HOST should be a hostname with enough disk space.
      hostname: [{{.Env.HOST}}]
      # cluster: [ ai2/general-cirrascale ]
